function setupWKWebViewJavascriptBridge(callback) {
  if (window.WKWebViewJavascriptBridge) {
    return callback(window.WKWebViewJavascriptBridge);
  }
  if (window.WKWVJBCallbacks) {
    return window.WKWVJBCallbacks.push(callback);
  }
  window.WKWVJBCallbacks = [callback];
  window.webkit?.messageHandlers?.iOS_Native_InjectJavascript?.postMessage(null);
}

setupWKWebViewJavascriptBridge(function (bridge) {
  // 呼叫 getPayload
  bridge.callHandler('getPayload', {}, function (response) {
    console.log('原生回傳的 payload:', response);
    document.getElementById('payloadResult').innerText = JSON.stringify(response, null, 2);
  });

  // 呼叫 closeWebView
  document.getElementById('closeWebViewBtn').addEventListener('click', function () {
    bridge.callHandler('closeWebView', {}, function () {
      console.log('WebView 已關閉');
    });
  });
});
